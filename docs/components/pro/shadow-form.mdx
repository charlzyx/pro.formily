# ğŸ‘» ShaowForm å½±å­è¡¨å•

ä»€ä¹ˆæ˜¯å½±å­è¡¨å•ï¼Ÿå½±å­è¡¨å•æ˜¯è„±ç¦»äºå½“å‰ Form å“åº”å¼ä¸Šä¸‹æ–‡çš„å­è¡¨å•

> æƒ³æ”»å‡»æˆ‘ï¼Ÿå…ˆè¯•ç€å’Œå½±å­ç©ğŸ¥Šå§

### æœ‰ä»€ä¹ˆç”¨ï¼Ÿ

å½“ä½ æƒ³å¯¹éƒ¨åˆ†å¯¹è±¡å­—æ®µè¿›è¡Œä¿®æ”¹çš„æ—¶å€™,ä½†åˆä¸æƒ³å¯¹å½“å‰è¡¨å•å“åº”å¼æ¨¡å‹äº§ç”Ÿå½±å“,å¯ä»¥è€ƒè™‘ä½¿ç”¨å½±å­è¡¨å•ã€‚å¦‚æœåªæ˜¯é’ˆå¯¹å•ä¸ªå­—æ®µä¿®æ”¹çš„è¯,ä½ å¯èƒ½åœ¨æ‰¾Editable

ä¸€ä¸ªå¸¸è§çš„ä¾‹å­ï¼šè¡¨æ ¼é‡Œé¢çš„è¡Œæ•°æ®ç¼–è¾‘,æˆ–è€…å¤§æ•°æ®å¯¹è±¡çš„éƒ¨åˆ†å±æ€§ç¼–è¾‘,å¸¸è§çš„å‡ ç§æ–¹æ¡ˆ

1. ä½¿ç”¨è·¯å¾„ç³»ç»Ÿå°†å½“å‰è¡Œæ‰€æœ‰æ•°æ®è½¬æ¢ä¸º editable
2. ä½¿ç”¨ Editable ç»„ä»¶å¯¹å¯ç¼–è¾‘ç»„ä»¶è¿›è¡ŒåŒ…è£¹
3. ä½¿ç”¨ FormDialog/FormDrawer è¿›è¡Œå¼¹çª—ç¼–è¾‘

å„æœ‰ä¼˜åŠ£,æ–¹æ¡ˆ1,2 åªèƒ½å¤„ç†ç¼–è¾‘å†…å®¹ä¸å±•ç¤ºå†…å®¹ä¸€è‡´çš„æƒ…å†µ,æ¯”å¦‚æ ¹æ®è¡Œidè·å–æ›´å¤šè¯¦æƒ…æ¥ç¼–è¾‘å°±å¤„ç†ä¸äº†ã€‚å†…å®¹å˜æ›´èŒƒå›´ä¸å¥½æå‡º,å‡å¦‚å˜æ›´å†…å®¹æ˜¯éœ€è¦å¼‚æ­¥ä¿å­˜åˆ°æœåŠ¡å™¨,è¯·æ±‚å‡ºé”™æœ¬åœ°å˜æ›´æ•°æ®å›æ»šå°±ä¼šå¾ˆéº»çƒ¦,ç‰¹åˆ«æ˜¯ initialValues å¯èƒ½å¹¶ä¸åƒä½ æƒ³çš„é‚£æ ·å·¥ä½œã€‚æˆ‘çš„issues
æ–¹æ¡ˆ3å®é™…ä½“éªŒç›¸å¯¹è¾ƒå·®,ä½“ç°åœ¨

a. è¿™ä¸¤ä¸ªæ˜¯apiè°ƒç”¨,ä¸èƒ½ä½¿ç”¨ schema æè¿°å‡ºæ¥

b. åˆ›å»ºçš„å¼¹çª—è„±ç¦»äº†å½“å‰ root æ ‘, ConfigProvider ä¹‹ç±»çš„å…¨å±€contex éœ€è¦åˆ°å•ç‹¬å†é…ç½®ä¸€ä»½,å¾ˆéº»çƒ¦ã€‚

### æ ¹æ®æˆ‘ç»ƒä¹ æ—¶é•¿ä¸¤å¹´åŠçš„ CRUD ç»éªŒ, æˆ‘æœŸæœ›ï¼š

1. èƒ½ä½¿ç”¨ Schema ï¼ˆæ²¡æˆ³ï¼æˆ‘å°±æ˜¯ schema è¯­æ³•é“ç²‰ï¼‰æè¿°
2. ä¸æ±¡æŸ“å½“å‰æ•°æ®ä¸å“åº”æ¨¡å‹,ä¸ç„¶æ€ä¹ˆå« shadow
3. ç”¨èµ·æ¥ä¸è¦å¤ªéº»çƒ¦,æ—¢ç„¶æ˜¯å­è¡¨å•,å…±äº«ä¸€ä¸‹æ ¹è¡¨å•çš„ä¸€äº›é…ç½®å±æ€§ä¹Ÿç†æ‰€å½“ç„¶å§

**å¾—ç›Šäº formily ä¼˜ç§€çš„ api è®¾è®¡, è®¾è®¡æ€è·¯å¦‚ä¸‹**

- ä½¿ç”¨ SchemaFieldOptionsContext è·å–æ ¹èŠ‚ç‚¹ createSchemaField ä¼ å…¥çš„æ³¨å†Œç»„ä»¶ä¸ scope, çœå»é‡æ–° createSchema çš„éº»çƒ¦
- ä½¿ç”¨ createForm åˆ›å»ºä¸€ä¸ªæ–°çš„å½±å­ form, ä¸æ ¹è¡¨å•æ²¡æœ‰ä»»ä½•å…³ç³», å½“ç„¶ä¹Ÿéœ€è¦æä¾›å¯é…ç½®é¡¹, å¯ä»¥ä¼ å…¥è‡ªå®šä¹‰çš„å¸¦ effects ç­‰é…ç½®çš„formå®ä¾‹ä»£æ›¿é»˜è®¤é…ç½®
- ç»„ä»¶è‡ªèº«åœ¨æ ¹è¡¨å•ä¸­æ˜¯ä¸€ä¸ªvoidèŠ‚ç‚¹,ä¸äº§ç”Ÿä»»ä½•æ•°æ®æ±¡æŸ“
- æ•°æ®åˆå§‹å€¼è·å–æ–¹å¼ promise, å­è¡¨å•å®ä¾‹ form.setvalues ([ä¸ºä»€ä¹ˆä¸æ˜¯initValues?](https://github.com/alibaba/formily/pull/4053)),field.record éå¸¸é€‚åˆä½œä¸ºé»˜è®¤å€¼[é“¾æ¥ä¸€ä¸‹ formily curdè§„èŒƒ
- ç›¸æ¯” Editable, ç¼–è¾‘ä¹‹å form reset/submit ç¡®è®¤çŠ¶æ€äº¤è¿˜ç»™ç”¨æˆ·å¤„ç†,å»ä»£æ›¿åŸå§‹å€¼orå‘èµ·ä¿å­˜/æ›´æ–°è¯·æ±‚ã€‚
- å½±å­è¡¨å•çš„ schema é…ç½®
- x-component è¿˜æ˜¯ x-decorator ? æˆ‘å…¨éƒ½è¦!

> Tip: ä¸ºä»€ä¹ˆ field.record éå¸¸é€‚åˆ?
> è¿™ç¯‡[æ ‡å‡†åŒ–CRUDä½œç”¨åŸŸå˜é‡è§„èŒƒ](https://github.com/alibaba/formily/discussions/3207) ç›´æŒ‡ formily æ¨¡å‹æŠ½è±¡æ ¸å¿ƒçš„å†…å®¹å°±å°¤ä¸ºé‡è¦, è¿™é‡Œé¢æåˆ°çš„ record æ˜¯å¦‚æ­¤çš„é‡è¦;
ä»¥è‡³äºåœ¨ 2.2.19 ç‰ˆæœ¬ä¸­, record è¢«ä½œä¸º Field æ¨¡å‹çš„æ ¸å¿ƒå±æ€§, ç›´æ¥è¿½åŠ åˆ°äº† BaseField ä¸Š.

> Tip: ä¸ºä»€ä¹ˆå¢åŠ  schema å±æ€§é…ç½®, ç›´æ¥ä½¿ç”¨ properties ä¸è¡Œå—
> å¯ä»¥æ˜¯å¯ä»¥, ä½†å¤–å±‚ form çš„ RecursionField (@formily/react#RecursionField) åœ¨æ¸²æŸ“çš„æ—¶å€™, ä¼šè¿›è¡Œæ„å»º, ç”Ÿæˆ children æ‰”ç»™ç»„ä»¶å¤„ç†, è™½ç„¶å¯ä»¥æ‰”æ‰ä¸ç”¨, ä½†å¤šä½™çš„åˆ›å»ºä¹Ÿæ˜¯ä¸å¿…è¦çš„æµªè´¹

### ä»£ç æ¡ˆä¾‹
<code src="../demos/ShadowFormAll.tsx"  />

### ShadowForm

```tsx | pure
export interface IShadowFormOptions {
  /** å­è¡¨å•Schema */
  schema: ISchema;
  /** createSchemaField å‡½æ•°é…ç½®, components å’Œ scope */
  schemaFieldOptions?: Parameters<typeof useShadowSchemaField>[0];
  /** createForm åˆ›å»ºçš„è¡¨å•å®ä¾‹, æœ‰è‡ªå®šä¹‰ effects ç­‰å¯ä»¥é€šè¿‡è‡ªå®šä¹‰ä¸€ä¸ª form è¿™ä¸ªä¼ å…¥ */
  form?: ReturnType<typeof createForm>;
}

export interface ShadowFormWrappedProps {
  form: ReturnType<typeof createForm>;
  SchemaField: ReturnType<typeof createSchemaField>;
  schema: ISchema;
}

```

### ShadowModal
> æ³¨æ„!  è¿™è·Ÿ ProArrayTable.ShadowModal å¹¶ä¸ä¸€æ ·

```tsx | pure
export const ShadowModal: React.FC<
  ShadowFormWrappedProps &
    Omit<React.ComponentProps<typeof Modal>, "onOk"> & {
      initLoader?: React.MutableRefObject<(record: any) => object | Promise<object>>;
      children?: React.ReactElement;
      onOk?: (data: any) => void | Promise<void>;
    }
>
```

### ShadowDrawer

> Welcome PR.

### useShadowForm

```tsx | pure
type useShadowForm = (opts: IShadowFormOptions) => ShadowFormWrappedProps
```
